<!DOCTYPE html>
<html lang="it">

<head>
  <title id="page-title">Rena Developer - Dashboard</title>
  <link rel="icon" type="image/x-icon" href="logo.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta charset="UTF-8">
  <link rel="stylesheet" href="style.css">
  <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Open+Sans&display=swap">
  <link href="https://api.fontshare.com/v2/css?f[]=open-sauce-one@400&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      background: black;
      color: white;
      font-family: 'Open Sauce One', sans-serif;
      min-height: 100vh;
      cursor: url('cursore.png'), auto;
    }

    .floating-navbar {
      position: fixed;
      top: 30px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(20px);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 50px;
      padding: 15px 40px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      width: 90%;
      max-width: 1000px;
      z-index: 1000;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
    }

    .floating-navbar:hover {
      background: rgba(0, 0, 0, 0.4);
      transform: translateX(-50%) translateY(-2px);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
    }

    .header-brand {
      text-decoration: none;
    }

    .header-brand:hover {
      transform: none;
    }

    .navbar-nav {
      display: flex;
      align-items: center;
      gap: 30px;
      flex: 1;
      justify-content: center;
    }

    .nav-link {
      color: white;
      text-decoration: none;
      font-size: 16px;
      font-weight: 500;
      padding: 8px 16px;
      border-radius: 20px;
      transition: all 0.3s ease;
      position: relative;
      display: flex;
      align-items: center;
      gap: 8px;
      line-height: 1;
    }

    .nav-link::before {
      display: none;
    }

    .nav-link:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: translateY(-2px);
    }

    .nav-link.active {
      background: rgba(255, 255, 255, 0.2);
      box-shadow: 0 2px 8px rgba(255, 255, 255, 0.2);
    }

    .navbar-account {
      display: flex;
      align-items: center;
      gap: 15px;
      flex-shrink: 0;
    }

    .account-menu {
      display: flex;
      align-items: center;
      cursor: pointer;
      transition: none;
    }

    .menu-icon {
      width: 28px;
      height: 28px;
      transition: none;
      display: block;
    }

    .menu-icon path {
      transition: none;
    }

    .profile-menu-container {
      position: relative;
      z-index: 200;
      display: flex;
      align-items: center;
      gap: 10px;
    }

    #profile-button {
      display: flex;
      align-items: center;
      justify-content: center;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
    }

    .profile-pic {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      object-fit: cover;
      border: 2px solid rgba(255, 255, 255, 0.3);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .profile-pic:hover {
      transform: scale(1.1);
      box-shadow: 0 0 10px rgba(255, 255, 255, 0.5);
    }

    .default-avatar {
      width: 40px;
      height: 40px;
      border-radius: 50%;
      background: rgba(255, 255, 255, 0.2);
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 18px;
      font-weight: 600;
      border: 2px solid rgba(255, 255, 255, 0.3);
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .profile-menu {
      display: none;
      position: absolute;
      top: 65px;
      right: -15px;
      background: rgba(0, 0, 0, 0.95);
      backdrop-filter: blur(10px);
      border-radius: 12px;
      padding: 15px;
      width: 200px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      border: 1px solid rgba(255, 255, 255, 0.1);
      z-index: 1000;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from {
        opacity: 0;
        transform: translateY(-10px);
      }

      to {
        opacity: 1;
        transform: translateY(0);
      }
    }

    .profile-menu.active {
      display: block;
      z-index: 1001;
    }

    .profile-menu-item {
      display: flex;
      align-items: center;
      padding: 10px;
      color: white;
      text-decoration: none;
      border-radius: 8px;
      transition: all 0.3s ease;
      margin-bottom: 5px;
    }

    .profile-menu-item:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .profile-menu-item i {
      margin-right: 10px;
      width: 20px;
      text-align: center;
    }

    .profile-menu-divider {
      height: 1px;
      background: rgba(255, 255, 255, 0.1);
      margin: 10px 0;
    }

    .language-option {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 8px;
      border-radius: 8px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .language-option:hover {
      background: rgba(255, 255, 255, 0.1);
    }

    .language-option.active {
      background: rgba(255, 255, 255, 0.15);
    }

    .language-content {
      display: flex;
      align-items: center;
    }

    .language-flag {
      width: 20px;
      height: 15px;
      margin-right: 10px;
      border-radius: 3px;
    }

    .check-icon {
      width: 16px;
      height: 16px;
      stroke: #4ade80;
      stroke-width: 2;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    .language-option.active .check-icon {
      opacity: 1;
    }

    @media screen and (max-width: 768px) {
      .floating-navbar {
        width: 95%;
        padding: 12px 20px;
        top: 20px;
        justify-content: space-between;
      }

      .profile-menu-container {
        order: 1;
        flex-grow: 1;
        display: flex;
        justify-content: flex-start;
        margin-left: -7px;
      }

      .navbar-logo {
        order: 2;
        position: static;
        left: auto;
        transform: none;
        flex-shrink: 0;
        display: flex;
        justify-content: center;
        align-items: center;
        flex-grow: 0;
        height: 100%;
      }

      .navbar-nav {
        display: none;
      }

      .navbar-account {
        order: 3;
        display: flex;
        align-items: center;
        gap: 10px;
        margin-left: 0;
        flex-grow: 1;
        justify-content: flex-end;
      }

      .menu-icon {
        width: 28px;
        height: 28px;
        transform: translateY(-1px) scaleX(-1);
      }

      .profile-menu {
        left: 0 !important;
        right: auto !important;
        transform: none !important;
      }
    }

    @media screen and (min-width: 769px) {
      .floating-navbar {
        top: 30px;
        max-width: 1100px;
      }

      .navbar-nav {
        display: flex;
        order: 2;
      }

      .navbar-logo {
        order: 1;
      }

      .profile-menu-container {
        order: 3;
      }

      .navbar-account {
        display: none;
      }
    }

    @media screen and (max-width: 480px) {
      .floating-navbar {
        padding: 8px 16px;
      }

      .menu-icon {
        width: 24px;
        height: 24px;
      }
    }

    #custom-menu {
      display: none;
      position: absolute;
      background: rgba(0, 0, 0, 0.9);
      border-radius: 15px;
      padding: 15px;
      backdrop-filter: blur(20px);
      z-index: 99999999;
      border: 1px solid rgba(255, 255, 255, 0.1);
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.5);
    }

    #custom-menu ul {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    #custom-menu ul li {
      margin-bottom: 10px;
    }

    #custom-menu ul li a {
      display: flex;
      align-items: center;
      color: #fff;
      text-decoration: none;
      padding: 8px 12px;
      border-radius: 8px;
      transition: all 0.3s ease;
    }

    #custom-menu ul li a:hover {
      background: rgba(255, 255, 255, 0.1);
      transform: translateX(5px);
    }

    #custom-menu ul li a img {
      margin-right: 10px;
      border-radius: 5px;
    }

    #custom-menu ul li a span {
      font-size: 16px;
    }

    #custom-menu ul li a.has-svg span {
      margin-left: 10px;
    }

    .custom-menu-svg {
      width: 22px;
      height: 22px;
      max-width: 100%;
      max-height: 100%;
    }

    main {
      padding-top: -20px;
    }

    @media (max-width: 767px) {
      #custom-menu {
        display: none !important;
      }
    }

    .login-popup {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: rgba(0, 0, 0, 0.8);
      display: flex;
      justify-content: center;
      align-items: center;
      z-index: 1000;
      opacity: 0;
      visibility: hidden;
      transition: all 0.3s ease;
    }

    .login-popup.active {
      opacity: 1;
      visibility: visible;
    }

    .login-popup-content {
      background: rgba(0, 0, 0, 0.9);
      border: 1px solid rgba(255, 255, 255, 0.1);
      border-radius: 16px;
      padding: 30px;
      width: 90%;
      max-width: 400px;
      box-shadow: 0 20px 40px rgba(0, 0, 0, 0.3);
      position: relative;
    }

    .close-popup {
      position: absolute;
      top: 15px;
      right: 15px;
      color: rgba(255, 255, 255, 0.6);
      font-size: 22px;
      cursor: pointer;
      transition: color 0.2s ease;
    }

    .close-popup:hover {
      color: white;
    }

    .spinner {
      width: 40px;
      height: 40px;
      border: 4px solid rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      border-top: 4px solid #fff;
      animation: spin 1s linear infinite;
    }

    @keyframes spin {
      0% {
        transform: rotate(0deg);
      }

      100% {
        transform: rotate(360deg);
      }
    }

    .context-menu-svg {
      width: 22px !important;
      height: 22px !important;
      margin-right: 10px;
    }

    .navbar-logo {
      position: relative;
    }

    .navbar-logo .header-brand {
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      display: block;
    }

    .navbar-logo-img {
      height: 55px;
      display: block;
    }

    @media screen and (min-width: 769px) {
      .navbar-logo-img {
        margin-left: 30px;
      }
    }

    .dashboard-hero {
      text-align: center;
      margin-top: 150px;
      margin-bottom: 30px;
      padding: 0 20px;
    }

    .dashboard-hero h1 {
      font-size: 2.5rem;
      margin-bottom: 15px;
    }

    .dashboard-hero p {
      max-width: 600px;
      margin: 0 auto;
      font-size: 1.1rem;
      line-height: 1.6;
      color: rgba(255, 255, 255, 0.8);
    }

    .dashboard-controls {
      display: flex;
      justify-content: space-between;
      align-items: center;
      max-width: 1200px;
      margin: 0 auto 30px;
      padding: 0 20px;
      flex-wrap: wrap;
      gap: 15px;
    }

    .search-box {
      display: flex;
      align-items: center;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 20px;
      padding: 8px 15px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      flex: 1;
      max-width: 400px;
    }

    .search-box input {
      background: transparent;
      border: none;
      color: white;
      padding: 5px 10px;
      width: 100%;
      font-family: inherit;
    }

    .search-box input:focus {
      outline: none;
    }

    .view-toggle {
      display: flex;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 20px;
      padding: 5px;
      border: 1px solid rgba(255, 255, 255, 0.1);
    }

    .view-toggle button {
      background: transparent;
      border: none;
      color: rgba(255, 255, 255, 0.7);
      padding: 8px 12px;
      border-radius: 15px;
      cursor: pointer;
      transition: all 0.3s ease;
    }

    .view-toggle button.active {
      background: rgba(255, 255, 255, 0.1);
      color: white;
    }

    .create-project-btn {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: white;
      padding: 12px 25px;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
      font-family: inherit;
      font-size: 16px;
    }

    .create-project-btn:hover {
      background: rgba(255, 255, 255, 0.2);
      transform: translateY(-2px);
    }

    .projects-grid {
      margin: 0 auto;
      padding: 0 20px 40px;
      max-width: 1200px;
      display: grid;
      grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
      gap: 30px;
    }

    .projects-list {
      margin: 0 auto;
      padding: 0 20px 40px;
      max-width: 1200px;
      display: none;
      flex-direction: column;
      gap: 15px;
    }

    .project-container {
      background: rgba(255, 255, 255, 0.05);
      border-radius: 20px;
      padding: 25px;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      transition: all 0.3s ease;
      border: 1px solid rgba(255, 255, 255, 0.1);
      display: flex;
      flex-direction: column;
    }

    .project-container:hover {
      transform: translateY(-5px);
      box-shadow: 0 12px 40px rgba(0, 0, 0, 0.4);
      background: rgba(255, 255, 255, 0.08);
    }

    .project-container.list-view {
      flex-direction: row;
      align-items: center;
      padding: 15px 25px;
    }

    .project-image {
      text-align: center;
      margin-bottom: 20px;
      border-radius: 15px;
      overflow: hidden;
      height: 180px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: rgba(0, 0, 0, 0.2);
    }

    .project-container.list-view .project-image {
      width: 80px;
      height: 80px;
      margin-bottom: 0;
      margin-right: 20px;
      flex-shrink: 0;
    }

    .project-image img {
      width: 100%;
      height: 100%;
      object-fit: cover;
      transition: transform 0.3s ease;
    }

    .project-container:hover .project-image img {
      transform: scale(1.05);
    }

    .project-content {
      flex: 1;
      display: flex;
      flex-direction: column;
    }

    .project-container.list-view .project-content {
      flex-direction: row;
      align-items: center;
      justify-content: space-between;
    }

    .project-title {
      margin-bottom: 10px;
      font-size: 1.4em;
    }

    .project-container.list-view .project-title {
      margin-bottom: 5px;
    }

    .project-description {
      margin-bottom: 20px;
      color: rgba(255, 255, 255, 0.8);
      line-height: 1.5;
      flex: 1;
    }

    .project-container.list-view .project-description {
      margin-bottom: 0;
      margin-right: 20px;
      max-width: 500px;
    }

    .project-meta {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 15px;
      font-size: 0.9em;
      color: rgba(255, 255, 255, 0.6);
    }

    .project-container.list-view .project-meta {
      margin-top: 0;
      flex-direction: column;
      align-items: flex-end;
      gap: 5px;
    }

    .project-actions {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }

    .project-container.list-view .project-actions {
      margin-top: 0;
    }

    .project-button {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: white;
      padding: 8px 15px;
      border-radius: 15px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 5px;
      text-decoration: none;
      font-family: inherit;
      font-size: 14px;
    }

    .project-button:hover {
      background: rgba(255, 255, 255, 0.2);
    }

    .project-button.primary {
      background: rgba(74, 222, 128, 0.2);
      border-color: rgba(74, 222, 128, 0.3);
    }

    .project-button.primary:hover {
      background: rgba(74, 222, 128, 0.3);
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: rgba(255, 255, 255, 0.6);
    }

    .empty-state i {
      font-size: 3rem;
      margin-bottom: 20px;
      opacity: 0.5;
    }

    .empty-state p {
      margin-bottom: 30px;
    }

    @media (max-width: 767px) {
      .project-container {
        width: 100%;
      }

      .project-container.list-view {
        flex-direction: column;
        align-items: flex-start;
      }

      .project-container.list-view .project-image {
        margin-right: 0;
        margin-bottom: 15px;
      }

      .project-container.list-view .project-content {
        flex-direction: column;
        align-items: flex-start;
      }

      .project-container.list-view .project-description {
        margin-right: 0;
        margin-bottom: 15px;
      }

      .project-container.list-view .project-meta {
        align-items: flex-start;
        margin-top: 15px;
      }

      .dashboard-controls {
        flex-direction: column;
        align-items: stretch;
      }

      .search-box {
        max-width: none;
      }
    }

    ::selection {
      background-color: white;
      color: black;
    }

    *:focus {
      outline: none;
    }

    * {
      -webkit-tap-highlight-color: transparent;
    }

    .project-image iframe {
      background: rgba(0, 0, 0, 0.2);
      border: none;
      transition: transform 0.3s ease;
    }

    .project-container:hover .project-image iframe {
      transform: scale(1.02);
    }

    @media (max-width: 767px) {
      .project-image iframe {
        pointer-events: none;
      }

      .project-container.list-view .project-image iframe {
        height: 80px !important;
      }
    }

    .iframe-container {
      position: relative;
      width: 100%;
      height: 100%;
      overflow: hidden;
    }

    .iframe-spinner {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      justify-content: center;
      align-items: center;
      background: rgba(0, 0, 0, 0.7);
      z-index: 10;
      transition: opacity 0.3s ease;
    }

    .iframe-spinner.hidden {
      opacity: 0;
      pointer-events: none;
    }

    .iframe-spinner .spinner {
      width: 30px;
      height: 30px;
      border: 3px solid rgba(255, 255, 255, 0.1);
      border-radius: 50%;
      border-top: 3px solid #fff;
      animation: spin 1s linear infinite;
    }

    iframe {
      width: 100%;
      height: 100%;
      border: none;
      opacity: 0;
      transition: opacity 0.3s ease;
    }

    iframe.loaded {
      opacity: 1;
    }

    .project-button.danger {
      background: rgba(239, 68, 68, 0.2);
      border-color: rgba(239, 68, 68, 0.3);
    }

    .project-button.danger:hover {
      background: rgba(239, 68, 68, 0.3);
    }

    .project-container .project-actions {
      display: flex;
      gap: 10px;
      margin-top: 15px;
      flex-wrap: wrap;
      justify-content: center;
      padding: 0 10px;
    }

    .project-container.list-view .project-actions {
      justify-content: flex-end;
      min-width: 200px;
      flex-shrink: 0;
    }

    @media (max-width: 480px) {
      .dashboard-controls {
        flex-direction: column;
        align-items: stretch;
        gap: 15px;
      }

      .search-box {
        order: 1;
      }

      .view-toggle {
        order: 2;
        align-self: center;
        margin: 0;
      }

      .create-project-btn {
        order: 3;
      }
    }

    .project-button {
      white-space: nowrap;
      min-width: max-content;
    }

    .project-button span {
      display: inline-block;
    }

    .project-actions {
      flex-wrap: nowrap !important;
    }

    .project-button {
      white-space: nowrap;
      flex-shrink: 0;
    }

    .project-container.list-view .project-actions {
      min-width: auto;
    }

    @media (max-width: 380px) {
      .project-actions {
        flex-wrap: wrap !important;
      }

      .project-button {
        flex: 1;
        min-width: 80px;
      }
    }

    @media screen and (min-width: 769px) {
      .dashboard-controls {
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
      }

      .search-and-toggle {
        order: 1;
        flex: 1;
        max-width: 500px;
        flex-direction: row;
      }

      .search-box {
        order: 1;
        flex: 1;
        max-width: 400px;
        margin-right: 15px;
      }

      .view-toggle {
        order: 2;
        margin-right: auto;
        margin-left: 15px;
      }

      .create-project-btn {
        order: 3;
      }
    }

    @media screen and (max-width: 768px) {
      .dashboard-controls {
        flex-direction: column;
        align-items: stretch;
      }

      .search-and-toggle {
        order: 2;
        flex-direction: column;
        align-items: stretch;
        max-width: none;
      }

      .view-toggle {
        align-self: center;
        margin: 10px 0;
      }

      .create-project-btn {
        order: 1;
        width: 100%;
        justify-content: center;
        margin-bottom: 15px;
      }
    }

    @media (max-width: 480px) {
      .dashboard-controls {
        gap: 10px;
      }

      .view-toggle {
        margin: 5px 0;
      }
    }

    @media (max-width: 480px) {
      .dashboard-controls {
        gap: 10px;
      }

      .view-toggle {
        margin: 5px 0;
      }
    }

    .search-and-toggle {
      display: flex;
      align-items: center;
      flex: 1;
      max-width: 500px;
      gap: 15px;
      order: 1;
    }

    .search-box {
      display: flex;
      align-items: center;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 20px;
      padding: 8px 15px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      flex: 1;
    }

    .view-toggle {
      display: flex;
      background: rgba(255, 255, 255, 0.05);
      border-radius: 20px;
      padding: 5px;
      border: 1px solid rgba(255, 255, 255, 0.1);
      flex-shrink: 0;
      margin-left: -20px;
    }

    .create-project-btn {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.1);
      color: white;
      padding: 12px 25px;
      border-radius: 20px;
      cursor: pointer;
      transition: all 0.3s ease;
      display: flex;
      align-items: center;
      gap: 8px;
      text-decoration: none;
      font-family: inherit;
      font-size: 16px;
      flex-shrink: 0;
      order: 2;
    }

    @media screen and (max-width: 768px) {
      .search-and-toggle {
        flex-direction: column;
        align-items: stretch;
        max-width: none;
      }

      .view-toggle {
        align-self: center;
        margin: 10px 0;
      }
    }

    @media (max-width: 480px) {
      .dashboard-controls {
        gap: 10px;
      }

      .view-toggle {
        margin: 5px 0;
      }
    }

    .mobile-create-btn-container {
      display: none;
    }

    .desktop-create-btn-container {
      display: block;
    }

    @media screen and (max-width: 768px) {
      .dashboard-controls {
        flex-direction: column;
        align-items: stretch;
        gap: 15px;
      }

      .mobile-create-btn-container {
        display: block;
        order: 1;
        width: 100%;
      }

      .desktop-create-btn-container {
        display: none;
      }

      .search-and-toggle {
        order: 2;
        display: flex;
        flex-direction: row;
        align-items: center;
        width: 100%;
        gap: 10px;
      }

      .search-box {
        flex: 1;
        margin-right: 0;
        max-width: none;
      }

      .view-toggle {
        margin: 0;
        flex-shrink: 0;
      }

      .create-project-btn {
        width: 100%;
        justify-content: center;
      }
    }

    @media screen and (min-width: 769px) {
      .dashboard-controls {
        flex-direction: row;
        justify-content: space-between;
        align-items: center;
      }

      .search-and-toggle {
        display: flex;
        align-items: center;
        flex: 1;
        max-width: 500px;
        gap: 15px;
        order: 1;
      }

      .search-box {
        flex: 1;
        margin-right: 0;
      }

      .view-toggle {
        margin: 0;
        flex-shrink: 0;
      }

      .desktop-create-btn-container {
        order: 2;
        flex-shrink: 0;
      }
    }

    .search-box {
      position: relative;
      display: flex;
      align-items: center;
    }

    .clear-search {
      cursor: pointer;
      padding: 5px;
      margin-left: 5px;
      font-size: 18px;
      color: rgba(255, 255, 255, 0.7);
      transition: color 0.3s ease;
    }

    .clear-search:hover {
      color: white;
    }

    .search-loading {
      position: relative;
    }

    .search-loading::after {
      content: '';
      position: absolute;
      right: 35px;
      top: 50%;
      transform: translateY(-50%);
      width: 16px;
      height: 16px;
      border: 2px solid rgba(255, 255, 255, 0.3);
      border-top: 2px solid white;
      border-radius: 50%;
      animation: spin 1s linear infinite;
    }

    @media (max-width: 767px) {
      .project-button.danger {
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 6px;
      }

      .project-button.danger i,
      .project-button.danger span {
        display: inline-flex;
        align-items: center;
      }
    }
  </style>
</head>

<body>
  <nav class="floating-navbar">
    <div class="profile-menu-container">
      <div id="profile-button"></div>
      <div class="profile-menu" id="profile-menu">
        <a href="https://rena.altervista.org/account.php" class="profile-menu-item" id="account-link">
          <i class="fas fa-user"></i>
          <span data-translate-it="Il mio account" data-translate-en="My Account">Il mio account</span>
        </a>
        <div class="profile-menu-divider"></div>
        <div class="profile-menu-item" style="pointer-events: none; opacity: 0.8;">
          <i class="fas fa-language"></i>
          <span data-translate-it="Lingua" data-translate-en="Language">Lingua</span>
        </div>
        <div class="language-option" data-lang="it" onclick="translatePage('it')">
          <div class="language-content">
            <img src="https://renadeveloper.altervista.org/bandierait.png" class="language-flag" alt="Italiano">
            <span>Italiano</span>
          </div>
          <svg class="check-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path>
          </svg>
        </div>
        <div class="language-option" data-lang="en" onclick="translatePage('en')">
          <div class="language-content">
            <img src="https://renadeveloper.altervista.org/bandieraen.png" class="language-flag" alt="English">
            <span>English</span>
          </div>
          <svg class="check-icon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" d="M5 13l4 4L19 7"></path>
          </svg>
        </div>
      </div>
    </div>

    <div class="navbar-logo">
      <a class="header-brand" href="https://renadeveloper.altervista.org">
        <img src="transparentdeveloper.png" alt="Rena Developer" class="navbar-logo-img">
      </a>
    </div>

    <div class="navbar-nav">
      <a href="https://renadeveloper.altervista.org" class="nav-link">
        <img src="https://gcsapp.altervista.org/homebanner.png" alt="Home" width="19">
        <span>Home</span>
      </a>
      <a href="https://renadeveloper.altervista.org/renastore.html" class="nav-link">
        <img src="https://renadeveloper.altervista.org/storemono.png" alt="Rena Store" width="20">
        <span data-translate-it="Aggiungi a Rena Store" data-translate-en="Add at the Rena Store">Aggiungi a Rena
          Store</span>
      </a>
      <a href="https://renadeveloper.altervista.org/modelli.html" class="nav-link">
        <img src="modell.png" alt="Modelli" width="22">
        <span data-translate-it="Modelli" data-translate-en="Templates">Modelli</span>
      </a>
      <a href="https://renadeveloper.altervista.org/code.html" class="nav-link">
        <svg class="custom-menu-svg" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg" stroke="#ffffff"
          width="110" height="110">
          <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
          <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
          <g id="SVGRepo_iconCarrier">
            <path
              d="M14 17L17 14L14 11M10 7L7 10L10 13M7.8 21H16.2C17.8802 21 18.7202 21 19.362 20.673C19.9265 20.3854 20.3854 19.9265 20.673 19.362C21 18.7202 21 17.8802 21 16.2V7.8C21 6.11984 21 5.27976 20.673 4.63803C20.3854 4.07354 19.9265 3.6146 19.362 3.32698C18.7202 3 17.8802 3 16.2 3H7.8C6.11984 3 5.27976 3 4.63803 3.32698C4.07354 3.6146 3.6146 4.07354 3.32698 4.63803C3 5.27976 3 6.11984 3 7.8V16.2C3 17.8802 3 18.7202 3.32698 19.362C3.6146 19.9265 4.07354 20.3854 4.63803 20.673C5.27976 21 6.11984 21 7.8 21Z"
              stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
          </g>
        </svg>
        <span>Code</span>
      </a>
      <a href="https://renadeveloper.altervista.org/webkit.html" class="nav-link">
        <img src="https://renadeveloper.altervista.org/webkitmono.png" alt="WebKit" width="20">
        <span>WebKit</span>
      </a>
    </div>

    <div class="navbar-account">
      <div class="account-menu">
        <a href="https://renadeveloper.altervista.org/menu.html">
          <svg class="menu-icon" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"
            transform="rotate(0)matrix(-1, 0, 0, 1, 0, 0)" stroke="#ffffff">
            <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
            <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
            <g id="SVGRepo_iconCarrier">
              <path d="M4 6H20M4 12H14M4 18H9" stroke="#ffffff" stroke-width="2" stroke-linecap="round"
                stroke-linejoin="round"></path>
            </g>
          </svg>
        </a>
      </div>
    </div>
  </nav>

  <div id="custom-menu">
    <ul>
      <li><a href="https://renadeveloper.altervista.org"><img src="https://gcsapp.altervista.org/homebanner.png"
            alt="Image 1" width="20"><span>Home</span></a></li>
      <li><a href="https://renadeveloper.altervista.org/renastore.html"><img
            src="https://renadeveloper.altervista.org/storemono.png" alt="Image 3" width="20"><span>Rena
            Store</span></a></li>
      <li><a href="https://renadeveloper.altervista.org/modelli.html">
          <svg class="context-menu-svg" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"
            stroke="#ffffff">
            <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
            <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
            <g id="SVGRepo_iconCarrier">
              <path
                d="M22 11V17C22 21 21 22 17 22H7C3 22 2 21 2 17V7C2 3 3 2 7 2H8.5C10 2 10.33 2.44 10.9 3.2L12.4 5.2C12.78 5.7 13 6 14 6H17C21 6 22 7 22 11Z"
                stroke="#ffffff" stroke-width="1.5" stroke-miterlimit="10"></path>
              <path d="M8 2H17C19 2 20 3 20 5V6.38" stroke="#ffffff" stroke-width="1.5" stroke-miterlimit="10"
                stroke-linecap="round" stroke-linejoin="round"></path>
            </g>
          </svg><span data-translate-it="Modelli" data-translate-en="Templates">Modelli</span></a></li>
      <li><a href="https://renadeveloper.altervista.org/code.html">
          <svg class="context-menu-svg" viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"
            stroke="#ffffff">
            <g id="SVGRepo_bgCarrier" stroke-width="0"></g>
            <g id="SVGRepo_tracerCarrier" stroke-linecap="round" stroke-linejoin="round"></g>
            <g id="SVGRepo_iconCarrier">
              <path
                d="M14 17L17 14L14 11M10 7L7 10L10 13M7.8 21H16.2C17.8802 21 18.7202 21 19.362 20.673C19.9265 20.3854 20.3854 19.9265 20.673 19.362C21 18.7202 21 17.8802 21 16.2V7.8C21 6.11984 21 5.27976 20.673 4.63803C20.3854 4.07354 19.9265 3.6146 19.362 3.32698C18.7202 3 17.8802 3 16.2 3H7.8C6.11984 3 5.27976 3 4.63803 3.32698C4.07354 3.6146 3.6146 4.07354 3.32698 4.63803C3 5.27976 3 6.11984 3 7.8V16.2C3 17.8802 3 18.7202 3.32698 19.362C3.6146 19.9265 4.07354 20.3854 4.63803 20.673C5.27976 21 6.11984 21 7.8 21Z"
                stroke="#ffffff" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"></path>
            </g>
          </svg><span>Code</span></a></li>
      <li><a href="https://renadeveloper.altervista.org/webkit.html"><img
            src="https://renadeveloper.altervista.org/webkitmono.png" alt="Image 1" width="20"><span>WebKit</span></a>
      </li>
    </ul>
  </div>

  <div class="login-popup" id="loginPopup">
    <div class="login-popup-content">
      <span class="close-popup" id="closePopup">&times;</span>
      <div class="spinner"></div>
    </div>
  </div>

  <main>
    <div class="dashboard-hero">
      <h1 data-translate-it="I miei progetti" data-translate-en="My Projects">I miei progetti</h1>
      <p data-translate-it="Gestisci e crea nuovi progetti per i tuoi siti web"
        data-translate-en="Manage and create new projects for your websites">
        Gestisci e crea nuovi progetti per i tuoi siti web
      </p>
    </div>

    <div class="dashboard-controls">
      <div class="mobile-create-btn-container">
        <button class="create-project-btn" id="createProjectBtn">
          <i class="fas fa-plus"></i>
          <span data-translate-it="Nuovo Progetto" data-translate-en="New Project">Nuovo Progetto</span>
        </button>
      </div>

      <div class="search-and-toggle">
        <div class="search-box">
          <i class="fas fa-search"></i>
          <input type="text" id="projectSearch" placeholder="Cerca progetti..." data-placeholder-it="Cerca progetti..."
            data-placeholder-en="Search projects...">
        </div>

        <div class="view-toggle">
          <button id="gridView" class="active"><i class="fas fa-th"></i></button>
          <button id="listView"><i class="fas fa-list"></i></button>
        </div>
      </div>

      <div class="desktop-create-btn-container">
        <button class="create-project-btn" id="createProjectBtnDesktop">
          <i class="fas fa-plus"></i>
          <span data-translate-it="Nuovo Progetto" data-translate-en="New Project">Nuovo Progetto</span>
        </button>
      </div>
    </div>

    <div class="projects-grid" id="projectsGrid">

    </div>

    <div class="projects-list" id="projectsList">

    </div>

    <div class="empty-state" id="emptyState">
      <i class="fas fa-folder-open"></i>
      <p data-translate-it="Non hai ancora creato progetti. Crea il tuo primo progetto!"
        data-translate-en="You haven't created any projects yet. Create your first project!">
        Non hai ancora creato progetti. Crea il tuo primo progetto!
      </p>
    </div>
  </main>

  <script>
    let projectsLoaded = false;

    function delay(ms) {
      return new Promise(resolve => setTimeout(resolve, ms));
    }

    document.addEventListener('contextmenu', function (e) {
      e.preventDefault();
      var menu = document.getElementById('custom-menu');
      menu.style.display = 'block';
      menu.style.left = e.pageX + 'px';
      menu.style.top = e.pageY + 'px';
    });

    document.addEventListener('click', function () {
      var menu = document.getElementById('custom-menu');
      menu.style.display = 'none';
    });

    document.getElementById('gridView').addEventListener('click', function () {
      this.classList.add('active');
      document.getElementById('listView').classList.remove('active');
      document.getElementById('projectsGrid').style.display = 'grid';
      document.getElementById('projectsList').style.display = 'none';
      runProjectSearch();
    });

    document.getElementById('listView').addEventListener('click', function () {
      this.classList.add('active');
      document.getElementById('gridView').classList.remove('active');
      document.getElementById('projectsGrid').style.display = 'none';
      document.getElementById('projectsList').style.display = 'flex';
      runProjectSearch();
    });

    document.getElementById('createProjectBtn').addEventListener('click', createNewProject);
    document.getElementById('createProjectBtnDesktop').addEventListener('click', createNewProject);

    function createNewProject() {
      const userData = JSON.parse(localStorage.getItem('user_data'));
      if (!userData || !userData.user_id) {
        alert('Devi effettuare il login per creare un progetto');
        openCrossDomainLogin();
        return;
      }

      const projectName = prompt('Inserisci il nome del nuovo progetto:');
      if (!projectName) return;

      const creationDate = new Date().toISOString().slice(0, 19).replace('T', ' ');

      fetch('https://rena.altervista.org/saveFile.php', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          titolo: projectName,
          descrizione: 'Nuovo progetto',
          linguaggio: 'html',
          autore: userData.user_id,
          token: userData.token,
          data_creazione: creationDate
        })
      })
        .then(response => response.json())
        .then(data => {
          if (data.status === 'success') {
            alert('Progetto creato con successo!');
            loadUserProjects();
          } else {
            alert('Errore nella creazione del progetto: ' + data.message);
          }
        })
        .catch(error => {
          console.error('Errore:', error);
          alert('Errore nella creazione del progetto');
        });
    }

    window.addEventListener('message', function (event) {
      console.log("Messaggio ricevuto:", event.data, "da origine:", event.origin);

      if (event.origin !== 'https://rena.altervista.org') {
        console.log("Messaggio da origine non autorizzata:", event.origin);
        return;
      }

      if (event.data && event.data.status === 'success') {
        console.log("Login successful, salvataggio dati utente");
        localStorage.setItem('user_data', JSON.stringify(event.data));

        updateProfileUI(event.data);
        startTokenVerification();

        document.getElementById('loginPopup').classList.remove('active');
      } else {
        console.log("Login fallito o formato messaggio non valido");
      }
    });

    function showLoginUI() {
      console.log("Mostra UI login");
      const profileButton = document.getElementById('profile-button');
      const accountLink = document.querySelector('.profile-menu-item');

      if (profileButton && accountLink) {
        profileButton.innerHTML = '<div class="default-avatar"><i class="fas fa-user"></i></div>';

        const span = accountLink.querySelector('span');
        if (span) {
          span.setAttribute('data-translate-it', 'Accedi');
          span.setAttribute('data-translate-en', 'Login');
          span.textContent = 'Accedi';
        }

        accountLink.onclick = function (e) {
          e.preventDefault();
          openCrossDomainLogin();
        };

        accountLink.href = "#";
      }
    }

    let isVerifyingToken = false;
    let tokenVerificationInterval = null;
    let accountLink = document.getElementById('account-link');

    document.addEventListener('DOMContentLoaded', function () {
      console.log("DOM completamente caricato");
      loadSavedLanguage();
      handleTokenFromURL();
      setupEventListeners();
      checkLoginStatus();
      setupSearchFunctionality();
      addClearSearchButton();
      runProjectSearch();
    });

    function setupEventListeners() {
      console.log("Impostazione event listeners");

      const profileButton = document.getElementById('profile-button');
      const profileMenu = document.getElementById('profile-menu');
      const closePopup = document.getElementById('closePopup');

      if (profileButton && profileMenu) {
        profileButton.addEventListener('click', function (e) {
          e.stopPropagation();
          profileMenu.classList.toggle('active');
        });

        document.addEventListener('click', function () {
          profileMenu.classList.remove('active');
        });

        profileMenu.addEventListener('click', function (e) {
          e.stopPropagation();
        });
      }

      if (closePopup) {
        closePopup.addEventListener('click', function () {
          document.getElementById('loginPopup').classList.remove('active');
        });
      }

      const gridViewBtn = document.getElementById('gridView');
      const listViewBtn = document.getElementById('listView');

      if (gridViewBtn && listViewBtn) {
        gridViewBtn.addEventListener('click', function () {
          this.classList.add('active');
          document.getElementById('listView').classList.remove('active');
          document.getElementById('projectsGrid').style.display = 'grid';
          document.getElementById('projectsList').style.display = 'none';
          runProjectSearch();
        });

        listViewBtn.addEventListener('click', function () {
          this.classList.add('active');
          document.getElementById('gridView').classList.remove('active');
          document.getElementById('projectsGrid').style.display = 'none';
          document.getElementById('projectsList').style.display = 'flex';
          runProjectSearch();
        });
      }

      const createProjectBtn = document.getElementById('createProjectBtn');
      const createProjectBtnDesktop = document.getElementById('createProjectBtnDesktop');

      if (createProjectBtn) {
        createProjectBtn.addEventListener('click', createNewProject);
      }

      if (createProjectBtnDesktop) {
        createProjectBtnDesktop.addEventListener('click', createNewProject);
      }
    }

    function openCrossDomainLogin() {
      console.log("Apertura login cross-domain");
      document.getElementById('loginPopup').classList.add('active');

      const loginUrl = `https://rena.altervista.org/login.php?external_domain=${encodeURIComponent(window.location.origin)}`;

      const loginWindow = window.open(
        loginUrl,
        'RenaLogin',
        'width=500,height=600,scrollbars=no,resizable=no'
      );

      if (!loginWindow) {
        document.getElementById('loginPopup').classList.remove('active');
        alert('Il browser ha bloccato la popup. Per favore consenti le popup per questo sito.');
        return;
      }

      const checkWindowClosed = setInterval(() => {
        if (loginWindow.closed) {
          clearInterval(checkWindowClosed);
          document.getElementById('loginPopup').classList.remove('active');
          checkLoginStatus();
        }
      }, 500);

      setTimeout(() => {
        if (!loginWindow.closed) {
          loginWindow.close();
          document.getElementById('loginPopup').classList.remove('active');
          alert('Tempo scaduto. Riprova.');
        }
      }, 30000);
    }

    function handleTokenFromURL() {
      console.log("Controllo token dall'URL");
      const urlParams = new URLSearchParams(window.location.search);
      const token = urlParams.get('token');
      const user_id = urlParams.get('user_id');
      const username = urlParams.get('username');

      if (token && user_id && username) {
        console.log("Token trovato nell'URL, salvataggio dati utente");
        const userData = {
          status: 'success',
          user_id: user_id,
          username: username,
          token: token,
          lastVerification: Date.now()
        };

        localStorage.setItem('user_data', JSON.stringify(userData));
        updateProfileUI(userData);
        startTokenVerification();
        window.history.replaceState({}, document.title, window.location.pathname);
      } else {
        checkLoginStatus();
      }
    }

    function checkLoginStatus() {
      console.log("Controllo stato login...");
      const savedUserData = localStorage.getItem('user_data');

      if (savedUserData) {
        try {
          const userData = JSON.parse(savedUserData);
          console.log("Dati utente trovati:", userData);

          updateProfileUI(userData);

          if (userData.token && !isVerifyingToken) {
            const now = Date.now();
            const lastVerification = userData.lastVerification || 0;

            if (now - lastVerification > 5000) {
              isVerifyingToken = true;
              console.log("Avvio verifica token dopo ritardo");

              setTimeout(() => {
                verifyToken(userData.token)
                  .then(valid => {
                    console.log("Risultato verifica token:", valid);
                    isVerifyingToken = false;

                    if (!valid) {
                      console.log("Token non valido, tentativo di refresh...");
                      refreshUserData();
                    } else {
                      userData.lastVerification = Date.now();
                      localStorage.setItem('user_data', JSON.stringify(userData));
                    }
                  })
                  .catch(error => {
                    console.error("Errore verifica token:", error);
                    isVerifyingToken = false;
                  });
              }, 1000);
            }
          }
        } catch (e) {
          console.error("Errore parsing dati utente:", e);
          localStorage.removeItem('user_data');
          showLoginUI();
        }
      } else {
        console.log("Nessun dato utente trovato");
        showLoginUI();
      }
    }

    window.addEventListener('message', function (event) {
      console.log("Messaggio ricevuto:", event.data, "da origine:", event.origin);

      const allowedOrigins = [
        'https://rena.altervista.org',
        'https://renadeveloper.altervista.org'
      ];

      if (!allowedOrigins.includes(event.origin)) {
        console.log("Messaggio da origine non autorizzata:", event.origin);
        return;
      }

      if (event.data && event.data.status === 'success') {
        console.log("Login successful, salvataggio dati utente");

        const userData = {
          status: 'success',
          user_id: event.data.user_id,
          username: event.data.username,
          token: event.data.token,
          profile_photo: event.data.profile_photo,
          lastVerification: Date.now()
        };

        localStorage.setItem('user_data', JSON.stringify(userData));

        updateProfileUI(userData);
        startTokenVerification();

        document.getElementById('loginPopup').classList.remove('active');
      }
    });

    function updateProfileUI(data) {
      console.log("Aggiornamento UI profilo con dati:", data);
      const profileButton = document.getElementById('profile-button');

      if (!profileButton) {
        console.error("Pulsante profilo non trovato");
        return;
      }

      profileButton.innerHTML = '';

      if (data && (data.logged_in === true || data.status === 'success' || data.user_id)) {
        const username = data.username || data.user_id || 'Utente';

        if (data.profile_photo) {
          console.log("Tentativo di caricamento foto profilo:", data.profile_photo);
          const img = document.createElement('img');
          img.className = 'profile-pic';
          img.alt = 'Foto profilo';
          img.src = data.profile_photo;

          img.onerror = function () {
            console.log("Errore caricamento foto profilo, uso avatar di default");
            this.remove();
            const defaultAvatar = document.createElement('div');
            defaultAvatar.className = 'default-avatar';
            defaultAvatar.textContent = username.charAt(0).toUpperCase();
            profileButton.appendChild(defaultAvatar);
          };

          img.onload = function () {
            console.log("Foto profilo caricata con successo");
          };

          profileButton.appendChild(img);
        } else {
          console.log("Nessuna foto profilo, uso avatar di default");
          const defaultAvatar = document.createElement('div');
          defaultAvatar.className = 'default-avatar';
          defaultAvatar.textContent = username.charAt(0).toUpperCase();
          profileButton.appendChild(defaultAvatar);
        }

        if (accountLink) {
          accountLink.href = `https://rena.altervista.org/account.php?user_id=${data.user_id}`;
        }

        console.log("UI profilo aggiornata per utente loggato");
      } else {
        console.log("UI profilo impostata per utente non loggato");
        const loginButton = document.createElement('div');
        loginButton.className = 'default-avatar';
        loginButton.innerHTML = '<i class="fas fa-user"></i>';
        loginButton.onclick = openCrossDomainLogin;
        profileButton.appendChild(loginButton);
      }
    }

    function showLoginUI() {
      console.log("Mostra UI login");
      const profileButton = document.getElementById('profile-button');
      const accountLink = document.querySelector('.profile-menu-item');

      if (profileButton && accountLink) {
        profileButton.innerHTML = '<div class="default-avatar"><i class="fas fa-user"></i></div>';

        const span = accountLink.querySelector('span');
        if (span) {
          span.setAttribute('data-translate-it', 'Accedi');
          span.setAttribute('data-translate-en', 'Login');
          span.textContent = 'Accedi';
        }

        accountLink.onclick = function (e) {
          e.preventDefault();
          openCrossDomainLogin();
        };

        accountLink.href = "#";
      }
    }

    async function verifyToken(token) {
      console.log("Verifica token in corso...");
      if (!token) return false;

      try {
        const response = await fetch('https://rena.altervista.org/verify_token.php', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({ token: token })
        });

        console.log("Status risposta:", response.status);
        console.log("Status text:", response.statusText);

        const result = await response.json();
        console.log("Risultato verifica completo:", result);

        return result.valid === true;
      } catch (error) {
        console.error("Errore durante la verifica del token:", error);
        return true;
      }
    }

    function refreshUserData() {
      console.log("Refresh dati utente");
      const savedUserData = localStorage.getItem('user_data');

      if (savedUserData) {
        try {
          const userData = JSON.parse(savedUserData);
          if (userData.token) {
            fetch('https://rena.altervista.org/get_user_data.php', {
              method: 'POST',
              headers: {
                'Content-Type': 'application/json',
              },
              body: JSON.stringify({ token: userData.token })
            })
              .then(response => {
                if (!response.ok) {
                  throw new Error('Network response was not ok');
                }
                return response.json();
              })
              .then(data => {
                if (data.status === 'success') {
                  const updatedUserData = {
                    ...userData,
                    ...data,
                    lastVerification: Date.now()
                  };
                  localStorage.setItem('user_data', JSON.stringify(updatedUserData));
                  updateProfileUI(updatedUserData);
                } else {
                  console.log("Refresh fallito, ma mantengo dati locali");
                }
              })
              .catch(error => {
                console.error("Errore durante l'aggiornamento dei dati utente:", error);
              });
          }
        } catch (e) {
          console.error("Errore parsing dati utente:", e);
        }
      }
    }

    function startTokenVerification() {
      console.log("Avvio verifica periodica token");
      if (tokenVerificationInterval) {
        clearInterval(tokenVerificationInterval);
      }

      tokenVerificationInterval = setInterval(() => {
        const savedUserData = localStorage.getItem('user_data');
        if (savedUserData) {
          try {
            const userData = JSON.parse(savedUserData);
            if (userData.token && !isVerifyingToken) {
              isVerifyingToken = true;
              verifyToken(userData.token)
                .then(valid => {
                  isVerifyingToken = false;
                  if (!valid) {
                    console.log("Token non valido, disconnessione");
                    localStorage.removeItem('user_data');
                    showLoginUI();
                    clearInterval(tokenVerificationInterval);
                  }
                })
                .catch(error => {
                  console.error("Errore verifica token:", error);
                  isVerifyingToken = false;
                });
            }
          } catch (e) {
            console.error("Errore parsing dati utente:", e);
            localStorage.removeItem('user_data');
            showLoginUI();
            clearInterval(tokenVerificationInterval);
          }
        } else {
          clearInterval(tokenVerificationInterval);
        }
      }, 30000);
    }

    function loadSavedLanguage() {
      console.log("Caricamento lingua salvata");
      const savedLang = localStorage.getItem('selectedLanguage') || 'it';
      translatePage(savedLang);
    }

    function translatePage(lang) {
      localStorage.setItem('preferredLanguage', lang);

      document.querySelectorAll('[data-translate-it]').forEach(function (el) {
        if (lang === 'it') {
          el.textContent = el.getAttribute('data-translate-it');
        } else if (lang === 'en') {
          el.textContent = el.getAttribute('data-translate-en');
        }
      });

      document.querySelectorAll('[data-placeholder-it]').forEach(function (el) {
        if (lang === 'it') {
          el.setAttribute('placeholder', el.getAttribute('data-placeholder-it'));
        } else if (lang === 'en') {
          el.setAttribute('placeholder', el.getAttribute('data-placeholder-en'));
        }
      });

      updateLanguageIndicator(lang);
      document.getElementById('profile-menu').classList.remove('active');
    }

    function updateLanguageIndicator(activeLang) {
      document.querySelectorAll('.language-option').forEach(function (option) {
        const lang = option.getAttribute('data-lang');
        if (lang === activeLang) {
          option.classList.add('active');
        } else {
          option.classList.remove('active');
        }
      });
    }

    function loadSavedLanguage() {
      const savedLang = localStorage.getItem('preferredLanguage') || 'it';
      translatePage(savedLang);
    }

    function openCrossDomainLogin() {
      console.log("Apertura login cross-domain");
      document.getElementById('loginPopup').classList.add('active');

      const loginUrl = `https://rena.altervista.org/login.php?external_domain=${encodeURIComponent(window.location.origin)}`;

      const loginWindow = window.open(
        loginUrl,
        'RenaLogin',
        'width=500,height=600,scrollbars=no,resizable=no'
      );

      if (!loginWindow) {
        document.getElementById('loginPopup').classList.remove('active');
        alert('Il browser ha bloccato la popup. Per favore consenti le popup per questo sito.');
        return;
      }

      const checkWindowClosed = setInterval(() => {
        if (loginWindow.closed) {
          clearInterval(checkWindowClosed);
          document.getElementById('loginPopup').classList.remove('active');
          checkLoginStatus();
        }
      }, 500);

      setTimeout(() => {
        if (!loginWindow.closed) {
          loginWindow.close();
          document.getElementById('loginPopup').classList.remove('active');
          alert('Tempo scaduto. Riprova.');
        }
      }, 30000);
    }

    async function loadUserProjects() {
      try {
        const userData = JSON.parse(localStorage.getItem('user_data'));

        if (!userData || !userData.user_id) {
          console.error("Utente non autenticato");
          projectsLoaded = false;
          showEmptyState();
          return;
        }

        document.getElementById('projectsGrid').innerHTML = `
            <div style="grid-column: 1 / -1; text-align: center; padding: 40px;">
                <div class="spinner" style="margin: 0 auto;"></div>
                <p style="margin-top: 20px;">Caricamento progetti...</p>
            </div>
        `;

        await delay(1000);

        const response = await fetch(`https://rena.altervista.org/getProjects.php?autore=${userData.user_id}`, {
          method: 'GET',
          headers: {
            'Content-Type': 'application/json'
          }
        });

        const data = await response.json();

        if (data.status === "success" && data.count > 0) {
          displayProjects(data.projects);
          projectsLoaded = true;
          setTimeout(runProjectSearch, 100);
        } else {
          projectsLoaded = true;
          showEmptyState();
        }
      } catch (error) {
        console.error("Errore nel caricamento progetti:", error);
        projectsLoaded = true;
        showEmptyState();
      }
    }

    function displayProjects(projects) {
      const projectsGrid = document.getElementById('projectsGrid');
      const projectsList = document.getElementById('projectsList');

      projectsGrid.innerHTML = '';
      projectsList.innerHTML = '';

      document.getElementById('emptyState').style.display = 'none';

      projects.forEach(project => {
        const formattedDate = formatDate(project.data_creazione);

        const languageImage = getLanguageImage(project.linguaggio);

        const gridProject = createProjectElement(project, formattedDate, languageImage, 'grid');
        projectsGrid.appendChild(gridProject);

        const listProject = createProjectElement(project, formattedDate, languageImage, 'list');
        projectsList.appendChild(listProject);
      });

      setTimeout(runProjectSearch, 100);
    }

    function createProjectElement(project, formattedDate, languageImage, viewType) {
      const projectContainer = document.createElement('div');
      projectContainer.className = `project-container ${viewType === 'list' ? 'list-view' : ''}`;

      const iframeHeight = viewType === 'list' ? '80px' : '180px';
      const projectId = project.id;

      projectContainer.innerHTML = `
        <div class="project-image">
            <div class="iframe-container">
                <div class="iframe-spinner">
                    <div class="spinner"></div>
                </div>
                <iframe 
                    src="https://renadeveloper.altervista.org/code.html?project=${projectId}" 
                    frameborder="0"
                    style="width: 100%; height: ${iframeHeight}; border-radius: 15px;"
                    loading="lazy"
                    sandbox="allow-same-origin allow-scripts"
                    onload="handleIframeLoad(this, ${projectId})"
                ></iframe>
            </div>
        </div>
        <div class="project-content">
            <h3 class="project-title">${escapeHtml(project.titolo)}</h3>
            <p class="project-description">${escapeHtml(project.descrizione || 'Nessuna descrizione')}</p>
            <div class="project-meta">
                <span>Creato: ${formattedDate}</span>
            </div>
            <div class="project-actions">
                <a href="https://renadeveloper.altervista.org/code.html?project=${projectId}" class="project-button">
                    <i class="fas fa-edit"></i> <span data-translate-en="Edit" data-translate-it="Modifica">Modifica</span>
                </a>
                <a href="javascript:void(0)" onclick="previewProject(${projectId})" class="project-button primary">
                    <i class="fas fa-eye"></i> <span data-translate-en="Preview" data-translate-it="Anteprima">Anteprima</span>
                </a>
                <a href="javascript:void(0)" onclick="deleteProject(${projectId})" class="project-button danger">
                    <i class="fas fa-trash"></i> <span data-translate-en="Delete" data-translate-it="Elimina">Elimina</span>
                </a>
            </div>
        </div>
    `;

      return projectContainer;
    }

    function showEmptyState() {
      document.getElementById('projectsGrid').innerHTML = '';
      document.getElementById('projectsList').innerHTML = '';
      document.getElementById('emptyState').style.display = 'block';
      runProjectSearch();
    }

    function formatDate(dateInput) {
      if (!dateInput) return "Data sconosciuta";

      const date = new Date(dateInput);

      if (isNaN(date.getTime())) {
        const mysqlDate = dateInput.replace(' ', 'T');
        const altDate = new Date(mysqlDate);

        if (isNaN(altDate.getTime())) {
          return "Data sconosciuta";
        }
        date = altDate;
      }

      const now = new Date();
      const diffTime = Math.abs(now - date);
      const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));

      if (diffDays === 0) {
        const diffHours = Math.floor(diffTime / (1000 * 60 * 60));
        if (diffHours === 0) {
          const diffMinutes = Math.floor(diffTime / (1000 * 60));
          return `${diffMinutes} minuti fa`;
        }
        return `${diffHours} ore fa`;
      } else if (diffDays === 1) {
        return "Ieri";
      } else if (diffDays < 7) {
        return `${diffDays} giorni fa`;
      } else if (diffDays < 30) {
        const weeks = Math.floor(diffDays / 7);
        return `${weeks} settimana${weeks > 1 ? 'e' : ''} fa`;
      } else {
        return date.toLocaleDateString('it-IT', {
          day: '2-digit',
          month: '2-digit',
          year: 'numeric'
        });
      }
    }

    function getLanguageImage(language) {
      const languageImages = {
        'html': 'https://via.placeholder.com/300x180/222222/E34F26?text=HTML',
        'css': 'https://via.placeholder.com/300x180/222222/1572B6?text=CSS',
        'javascript': 'https://via.placeholder.com/300x180/222222/F7DF1E?text=JS',
        'php': 'https://via.placeholder.com/300x180/222222/777BB4?text=PHP',
        'python': 'https://via.placeholder.com/300x180/222222/3776AB?text=Python'
      };

      return languageImages[language.toLowerCase()] || 'https://via.placeholder.com/300x180/222222/666666?text=Code';
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    function updateProfileUI(data) {
      console.log("Aggiornamento UI profilo con dati:", data);
      const profileButton = document.getElementById('profile-button');

      if (!profileButton) {
        console.error("Pulsante profilo non trovato");
        return;
      }

      profileButton.innerHTML = '';

      if (data && (data.logged_in === true || data.status === 'success' || data.user_id)) {
        const username = data.username || data.user_id || 'Utente';

        if (data.profile_photo) {
          console.log("Tentativo di caricamento foto profilo:", data.profile_photo);
          const img = document.createElement('img');
          img.className = 'profile-pic';
          img.alt = 'Foto profilo';
          img.src = data.profile_photo;

          img.onerror = function () {
            console.log("Errore caricamento foto profilo, uso avatar di default");
            this.remove();
            const defaultAvatar = document.createElement('div');
            defaultAvatar.className = 'default-avatar';
            defaultAvatar.textContent = username.charAt(0).toUpperCase();
            profileButton.appendChild(defaultAvatar);

            loadUserProjects();
          };

          img.onload = function () {
            console.log("Foto profilo caricata con successo");
            loadUserProjects();
          };

          profileButton.appendChild(img);
        } else {
          console.log("Nessuna foto profilo, uso avatar di default");
          const defaultAvatar = document.createElement('div');
          defaultAvatar.className = 'default-avatar';
          defaultAvatar.textContent = username.charAt(0).toUpperCase();
          profileButton.appendChild(defaultAvatar);

          loadUserProjects();
        }

        if (accountLink) {
          accountLink.href = `https://rena.altervista.org/account.php?user_id=${data.user_id}`;
        }

        console.log("UI profilo aggiornata per utente loggato");
      } else {
        console.log("UI profilo impostata per utente non loggato");
        const loginButton = document.createElement('div');
        loginButton.className = 'default-avatar';
        loginButton.innerHTML = '<i class="fas fa-user"></i>';
        loginButton.onclick = openCrossDomainLogin;
        profileButton.appendChild(loginButton);

        showEmptyState();
      }
    }

    document.addEventListener('DOMContentLoaded', function () {

      const savedUserData = localStorage.getItem('user_data');
      if (savedUserData) {
        try {
          const userData = JSON.parse(savedUserData);
          if (userData && userData.user_id) {
            loadUserProjects();
          }
        } catch (e) {
          console.error("Errore nel parsing dei dati utente:", e);
        }
      }
    });

    function previewProject(projectId) {
      const previewModal = document.createElement('div');
      previewModal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        background: rgba(0, 0, 0, 0.9);
        z-index: 10000;
        display: flex;
        justify-content: center;
        align-items: center;
    `;

      const iframeContainer = document.createElement('div');
      iframeContainer.style.cssText = `
        width: 90%;
        height: 90%;
        position: relative;
    `;

      const spinner = document.createElement('div');
      spinner.style.cssText = `
        position: absolute;
        top: 0;
        left: 0;
        width: 100%;
        height: 100%;
        display: flex;
        justify-content: center;
        align-items: center;
        background: rgba(0, 0, 0, 0.7);
        z-index: 10;
    `;

      const innerSpinner = document.createElement('div');
      innerSpinner.className = 'spinner';
      innerSpinner.style.cssText = `
        width: 40px;
        height: 40px;
    `;

      spinner.appendChild(innerSpinner);

      const iframe = document.createElement('iframe');
      iframe.style.cssText = `
        width: 100%;
        height: 100%;
        border: none;
        border-radius: 12px;
        background: white;
        opacity: 0;
        transition: opacity 0.3s ease;
    `;

      iframe.src = `https://renadeveloper.altervista.org/code.html?project=${projectId}`;

      iframe.onload = function () {
        setTimeout(() => {
          spinner.style.display = 'none';
          iframe.style.opacity = '1';
        }, 1000);
      };

      iframeContainer.appendChild(spinner);
      iframeContainer.appendChild(iframe);

      const closeBtn = document.createElement('button');
      closeBtn.innerHTML = '&times;';
      closeBtn.style.cssText = `
        position: absolute;
        top: 20px;
        right: 20px;
        background: rgba(255, 255, 255, 0.1);
        border: none;
        color: white;
        font-size: 30px;
        width: 50px;
        height: 50px;
        border-radius: 50%;
        cursor: pointer;
        backdrop-filter: blur(10px);
        z-index: 10001;
    `;

      closeBtn.onclick = () => {
        document.body.removeChild(previewModal);
        document.removeEventListener('keydown', closeOnEsc);
      };

      previewModal.appendChild(iframeContainer);
      previewModal.appendChild(closeBtn);
      document.body.appendChild(previewModal);

      const closeOnEsc = (e) => {
        if (e.key === 'Escape') {
          document.body.removeChild(previewModal);
          document.removeEventListener('keydown', closeOnEsc);
        }
      };
      document.addEventListener('keydown', closeOnEsc);

      previewModal.addEventListener('click', (e) => {
        if (e.target === previewModal) {
          document.body.removeChild(previewModal);
          document.removeEventListener('keydown', closeOnEsc);
        }
      });
    }

    function handleIframeLoad(iframe, projectId) {
      const container = iframe.parentElement;
      const spinner = container.querySelector('.iframe-spinner');

      setTimeout(() => {
        spinner.classList.add('hidden');
        iframe.classList.add('loaded');
      }, 1000);
    }

    function deleteProject(projectId) {
      if (!confirm('Sei sicuro di voler eliminare questo progetto? Questa azione non può essere annullata.')) {
        return;
      }

      const userData = JSON.parse(localStorage.getItem('user_data'));
      if (!userData || !userData.user_id) {
        alert('Devi effettuare il login per eliminare un progetto');
        return;
      }

      fetch('https://rena.altervista.org/deleteProject.php', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json',
        },
        body: JSON.stringify({
          project_id: projectId,
          user_id: userData.user_id,
          token: userData.token
        })
      })
        .then(response => response.json())
        .then(data => {
          if (data.status === 'success') {
            alert('Progetto eliminato con successo!');
            loadUserProjects();
          } else {
            alert('Errore nell\'eliminazione: ' + data.message);
          }
        })
        .catch(error => {
          console.error('Errore:', error);
          alert('Errore nell\'eliminazione del progetto');
        });
    }

    function setupSearchFunctionality() {
      console.log("Impostazione funzionalità di ricerca");

      const searchInput = document.getElementById('projectSearch');
      if (searchInput) {
        searchInput.addEventListener('input', function () {
          runProjectSearch();
        });

        addClearSearchButton();
      }
    }

    function runProjectSearch() {
      if (typeof projectsLoaded === 'undefined' || !projectsLoaded) {
        console.log("Progetti non ancora caricati, ricerca in attesa...");
        setTimeout(runProjectSearch, 500);
        return;
      }

      const searchTerm = document.getElementById('projectSearch').value.toLowerCase().trim();
      const isGridView = document.getElementById('gridView').classList.contains('active');
      const projectsContainer = isGridView ?
        document.getElementById('projectsGrid') :
        document.getElementById('projectsList');

      if (!projectsContainer || projectsContainer.children.length === 0) {
        showEmptyState();
        return;
      }

      const projects = projectsContainer.querySelectorAll('.project-container');
      let visibleCount = 0;

      projects.forEach(project => {
        const titleElement = project.querySelector('.project-title');
        const title = titleElement ? titleElement.textContent.toLowerCase() : '';
        const descriptionElement = project.querySelector('.project-description');
        const description = descriptionElement ? descriptionElement.textContent.toLowerCase() : '';

        const matches = title.includes(searchTerm) || description.includes(searchTerm);

        project.style.display = matches ? '' : 'none';
        if (matches) visibleCount++;
      });

      const emptyState = document.getElementById('emptyState');
      if (emptyState) {
        if (visibleCount === 0 && searchTerm) {
          emptyState.style.display = 'block';
          emptyState.innerHTML = `
                <i class="fas fa-search"></i>
                <p data-translate-it="Nessun progetto trovato per '${searchTerm}'" 
                   data-translate-en="No projects found for '${searchTerm}'">
                   Nessun progetto trovato per '${searchTerm}'
                </p>
            `;
          translatePage(localStorage.getItem('preferredLanguage') || 'it');
        } else if (visibleCount === 0) {
          emptyState.style.display = 'block';
          emptyState.innerHTML = `
                <i class="fas fa-folder-open"></i>
                <p data-translate-it="Non hai ancora creato progetti. Crea il tuo primo progetto!" 
                   data-translate-en="You haven't created any projects yet. Create your first project!">
                   Non hai ancora creato progetti. Crea il tuo primo progetto!
                </p>
            `;
          translatePage(localStorage.getItem('preferredLanguage') || 'it');
        } else {
          emptyState.style.display = 'none';
        }
      }
    }
  </script>
</body>

</html>
